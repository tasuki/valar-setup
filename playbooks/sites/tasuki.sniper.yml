- name: Set up sniper.tasuki (@handshake)
  hosts: all
  vars:
    repo: https://github.com/tasuki/sniper.git
    chdir: /var/www/tasuki/sniper
  tasks:
    - name: "Clone {{ repo }} to {{ chdir }}"
      import_tasks: ../../roles/git-deployments/tasks/clone.yml

    - name: Install Elm
      import_tasks: ../tasks/install-elm.yml

    - name: "Check whether {{ chdir }}/sniper.js exists"
      stat:
        path: "{{ chdir }}/sniper.js"
      register: generated_js
    - name: Make
      make:
        chdir: "{{ chdir }}"
      when: not generated_js.stat.exists
